<!DOCTYPE html>
<html lang="zh-CN">

<head>
    <meta charset="UTF-8">
    <title>应用导航</title>
    <style>
        html,
        body {
          margin: 0;
          padding: 0;
          height: 100%;
          width: 100%;
          font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, "Noto Sans", Arial, sans-serif;
          background: #f9f9f9;
        }

        body {
          display: flex;
          flex-direction: column;
          height: 100vh;
        }

        header {
          background: #2563eb;
          color: #fff;
          height: 60px;
          display: flex;
          align-items: center;
          padding: 0 16px;
          flex-shrink: 0;
          position: fixed;
          top: 0;
          left: 0;
          right: 0;
          z-index: 1000;
          gap: 12px;
        }

        .menu-btn {
          font-size: 22px;
          cursor: pointer;
          background: none;
          border: none;
          color: #fff;
        }

        h1 {
          margin: 0;
          font-size: 20px;
          flex: 1;
        }

        .container {
          display: flex;
          flex: 1;
          margin-top: 60px;
          /* header 高度 */
          height: calc(100vh - 60px);
        }

        nav {
          width: 220px;
          background: #f3f4f6;
          height: 100%;
          overflow-y: auto;
          transition: transform 0.3s ease;
        }

        nav.collapsed {
          transform: translateX(-100%);
        }

        main {
          flex: 1;
          padding: 16px;
          overflow: auto;
          transition: margin-left 0.3s ease;
        }

        main.expanded {
          margin-left: 0;
        }

        ul {
          list-style: none;
          padding: 0;
          margin: 0;
        }

        li {
          margin: 10px 0;
        }

        a {
          display: block;
          padding: 12px 16px;
          background: #fff;
          border: 1px solid #ddd;
          border-radius: 8px;
          text-decoration: none;
          color: #333;
          font-weight: 500;
          margin: 0 10px;
        }

        a:hover {
          background-color: #2563eb;
          color: #fff;
          border-color: #2563eb;
        }

        #markdown-container {
          border: 1px solid #ccc;
          border-radius: 5px;
          width: 100%;
          max-width: 1600px;
          display: flex;
          flex-direction: column;
        }

        #markdown-input {
          padding: 10px;
          width: 100%;
          min-height: 300px;
          box-sizing: border-box;
          overflow: hidden;
          resize: vertical;
        }

        #markdown-output {
          flex: 1;
          padding: 10px;
          width: 100%;
          box-sizing: border-box;
          display: none;
          overflow: auto;
          border-top: 1px solid #eee;
        }

        #markdown-container button {
          padding: 6px 12px;
          border: 1px solid #ddd;
          border-radius: 5px;
          background-color: #fff;
          cursor: pointer;
          transition: all 0.2s ease;
          margin-right: 10px;
        }

        #markdown-container button:hover {
          background-color: #2563eb;
          color: #fff;
          border-color: #2563eb;
        }



        @media (max-width: 768px) {
          .container {
            flex-direction: column;
          }

          nav {
            width: 100%;
            height: auto;
            order: 0;
            /* 顶部 */
            transform: none;
          }

          nav.collapsed {
            display: none;
          }

          main {
            margin-left: 0;
            order: 1;
            height: calc(100vh - 60px);
          }
        }
    </style>
</head>

<body>
<header>
    <button class="menu-btn" id="menu-toggle">☰</button>
    <h1>应用导航中心</h1>
</header>
<div class="container">
    <nav id="sidebar">
        <ul>
            <li><a href="/chat/">AI聊天</a></li>
            <li><a href="/chat/message">代理聊天</a></li>
            <li><a href="/chat/prompt">提示词生成</a></li>
            <li><a href="/chat/debate">辩论模拟</a></li>
            <li><a href="/chat/consensus">共识讨论</a></li>
            <li><a href="/chat/conversations">对话摘要处理</a></li>
            <li><a href="/ideatech/">微信发送</a></li>
            <li><a href="/table/list">填充数据表</a></li>
            <li><a href="/table/view/agent_robot">AI记录</a></li>
            <li><a href="/table/view/agent_history">代理历史</a></li>
        </ul>
    </nav>

    <main id="main-content">
        <h2>内容区域</h2>
        <div id="markdown-container">
            <textarea id="markdown-input" placeholder="请输入 Markdown 文本"></textarea>
            <div style="display:flex; margin:10px 0;">
                <button id="toggle-btn">转换</button>
                <button id="check-btn">检查</button>
                <button id="export-btn" style="display:none;">导出</button>
            </div>
            <div id="markdown-output"></div>
            <!-- 渲染结果显示在这里 -->

        </div>
    </main>
</div>
<script>
    const input = document.getElementById('markdown-input');
    const output = document.getElementById('markdown-output');
    const toggleBtn = document.getElementById('toggle-btn');
    const exportBtn = document.getElementById('export-btn');
    const checkBtn = document.getElementById('check-btn');

    const sidebar = document.getElementById('sidebar');
    const mainContent = document.getElementById('main-content');
    const menuToggle = document.getElementById('menu-toggle');

    let showInput = true;

    toggleBtn.addEventListener('click', async () => {
      if (showInput) {
        const rawText = input.value.trim();
        if (!rawText) {
          output.innerHTML = "<em>请输入内容后再转换</em>";
          return;
        }


        let bodyData;
        try {
          // 尝试解析成 JSON
          const parsed = JSON.parse(rawText);
          if (typeof parsed === 'object' && parsed !== null) {
            // JSON 对象或数组 → 结构化对象
            bodyData = parsed;
          } else {
            // 其他类型 → 作为普通文本 Markdown
            bodyData = { text: rawText };
          }
        } catch {
          // 解析失败 → 普通 Markdown
          bodyData = { text: rawText };
        }

        try {
          const res = await fetch("/markdown/", {
            method: "POST",
            headers: { "Content-Type": "application/json", },
            body: JSON.stringify(bodyData),
          });
          if (!res.ok) { res = await fetch(`/markdown/?text=${encodeURIComponent(rawText)}`); }
          if (!res.ok) throw new Error(`请求失败: ${res.status}`);
          const html = await res.text();
          output.innerHTML = html;
          input.style.display = 'none';
          output.style.display = 'block';
          exportBtn.style.display = 'inline-block';
          checkBtn.style.display = 'none';
          toggleBtn.textContent = '编辑';
        } catch (err) {
          output.innerHTML = `<span style="color:red;">${err}</span>`;
        }
      } else {
        input.style.display = 'block';
        output.style.display = 'none';
        exportBtn.style.display = 'none';
        checkBtn.style.display = 'inline-block';
        toggleBtn.textContent = '转换';
        input.focus();
      }
      showInput = !showInput;
    });

    checkBtn.addEventListener('click', async () => {
      const rawText = input.value.trim();
      if (!rawText) {
        output.innerHTML = "<em>请输入内容后再检查</em>";
        return;
      }
      let bodyData;
      try {
        // 尝试解析成 JSON
        const parsed = JSON.parse(rawText);
        if (typeof parsed === 'object' && parsed !== null) {
          // JSON 对象或数组 → 结构化对象
          bodyData = parsed;
        } else {
          // 其他类型 → 作为普通文本 Markdown
          bodyData = { text: rawText };
        }
      } catch {
        // 解析失败 → 普通 Markdown
        bodyData = { text: rawText };
      }

      try {
        const res = await fetch("/markdown/check", {
          method: "POST",
          headers: { "Content-Type": "application/json", },
          body: JSON.stringify(bodyData),
        });
        if (!res.ok) throw new Error(`检查失败: ${res.status}`);
        const issues = await res.json();
        if (issues.length === 0) {
          output.innerHTML = "<em>没有发现问题</em>";
        }
        else {
          output.innerHTML = `<pre>${JSON.stringify(issues, null, 2)}</pre>`;
        }
        output.style.display = 'block';
      } catch (err) {
        output.innerHTML = `<span style="color:red;">${err}</span>`;
      }
    });

    exportBtn.addEventListener('click', () => {
      const content = output.innerHTML;
      const printWindow = window.open("", "_blank");
      printWindow.document.write(`
            <!DOCTYPE html>
            <html>
            <head>
                <meta charset="utf-8">
                <title>导出 PDF</title>
                <style>
                    body {
                        font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, "Noto Sans", Arial, sans-serif;
                        padding: 20px;
                        max-width: 800px;
                        margin: 0 auto;
                    }
                </style>
            </head>
            <body>${content}</body>
            </html>
        `);
      printWindow.document.close();
      printWindow.focus();
      printWindow.print(); // 直接调用浏览器打印
    });

    menuToggle.addEventListener('click', () => {
      if (window.innerWidth <= 768) {
        // 移动端：切换显示
        sidebar.classList.toggle('collapsed');
      } else {
        // 桌面端：折叠
        sidebar.classList.toggle('collapsed');
        mainContent.classList.toggle('expanded');
      }
    });
</script>
</body>

</html>