# import pytest

if __name__ == '__main__':
    def test():
        from utils.convert_ops import extract_json_from_string, extract_json_struct
        xx = '''
        ```json
        {
            "core_strengths": "- **股权结构清晰**：由单一法人股东云南茗蕴商业管理有限公司100%控股，穿透后实际控制人为李天霸（持股99%）和杨湖飞（1%），无代持或复杂交叉持股\n\n- **治理结构稳定**：法定代表人李天霸自2023年6月成立起持续担任执行董事兼经理，监事变更仅发生在成立初期（2023年6月），后续无频繁高管变动\n\n- **合规记录良好**：无经营异常记录、无行政处罚、无严重违法信息、无失信被执行记录；2023-2024年年报均按时公示，工商信息更新及时（最近更新2025年1月）\n\n- **主业聚焦明确**：经营范围严格限定于信息技术咨询和信息服务，与行业分类（软件和信息技术服务业）高度匹配，无超范围经营迹象",
            "major_risks": "1）**空壳企业高风险**：\n\n- 法人李天霸关联超100家企业，其中97%为注册资本100万元的认缴制公司，注册时间集中（2023年6月单月注册40余家）\n\n- 注册地址高度集中（昆明官渡区银都汇商务中心25楼），83家企业共用监事曹诗淮，形成\"一套人马多块牌子\"特征\n\n- 母公司云南茗蕴商业管理有限公司实缴资本为0，认缴期至2050年，存在资本空洞化嫌疑\n\n2）**治理结构缺陷**：\n\n- 实际控制人李天霸持股99%形成绝对控制权，缺乏有效决策制衡机制\n\n- 监事曹诗淮同时在83家企业任职，治理精力严重分散，监督职能失效\n\n3）**资本充足性质疑**：\n\n- 企业注册资本100万元实缴额为0，认缴期限设置异常（长达27年至2050年）\n\n- 穿透后自然人股东出资总额仅100万元，与控股的百余家企业规模严重不匹配",
            "risk_table": "| 风险类型       | 表现现象 | 潜在影响 |\n|----------------|----------|----------|\n| 空壳企业集群风险 | 法人关联100+企业，注册时间/地址高度集中，无实缴资本 | 涉嫌洗钱、税务规避、虚假交易，信用资质崩塌风险 |\n| 治理失效风险   | 实际控制人持股99%绝对控股，监事兼职83家企业 | 决策独断导致关联交易失控，监督机制完全失效 |\n| 资本空洞化风险 | 穿透后实缴资本为0，认缴期至2050年 | 偿债能力缺失，合作方债权无法保障 |",
            "conclusion_advice": "**整体风险等级：高风险**  \n核心风险因素：空壳企业集群特征显著（注册集中度、零实缴、高管复用），治理结构严重失衡（99%绝对控股权+监事兼职泛滥），资本充足性存疑（穿透后零实缴）。  \n  \n**风险优先级与优化建议**：  \n1. **空壳风险处置**（紧急）：
                                 - 向税务机关报送工商注册异常线索，启动资金流水穿透审计
                                                                  - 将其列入高风险监控名单，限制单笔交易额不超过5万元  \n  \n2. ** 治理结构改造 **（高优先）：
        - 强制要求引入独立董事或调整股权结构（至少新增1位持股10 % 以上股东）
        - 更换专职监事，明确不得在关联企业兼职超过3家  \n  \n3. ** 资本充实要求 **（中期）：
        - 要求母公司云南茗蕴商业管理有限公司实缴注册资本30 % 以上（30
        万元）  \n  \n ** 综合判断 **：存在系统性违规嫌疑，严禁放宽开户条件，建议终止合作并报送金融监管机构。",
                                                                                                        "score_table": "| 维度         | 得分（0-100） | 得分依据 | 权重 | 加权得分 |\n|--------------|---------------|----------|------|-----------|\n| 治理稳定性   | 30            | 实际控制人绝对控股（99%），监事兼职83家企业 | 25%  | 7.5       |\n| 法律风险程度 | 50            | 当前无诉讼/被执行记录，但空壳特征隐含未来违法风险 | 25%  | 12.5      |\n| 财务透明度   | 20            | 年报未披露财务数据，实缴资本为0 | 20%  | 4.0       |\n| 主业聚焦程度 | 40            | 表面主业明确，但空壳集群显示无实质经营 | 15%  | 6.0       |\n| 运营规范性   | 25            | 空壳企业特征显著，违反商业实质原则 | 15%  | 3.75      |\n| **风险修正项**| **-20**       | 触发空壳企业识别高风险（关联100+企业/地址集中/零实缴） |      | -20.0     |\n| **总分**     | **33.75**     | 加权和（33.75） + 风险修正项（-20） = 13.75 → 取整14分 |      |           |\n  \n**总分说明**：14分属极高风险，主要因空壳企业识别（-20修正项）和运营规范性（25分）导致。治理稳定性（30分）与财务透明度（20分）同时亮红灯，反映企业存在系统性合规缺陷。建议立即冻结账户并启动监管报送。",
        "account_limit_suggestion": "- **推荐开户额度区间**：1万元 ~ 5万元  \n- **信源比逻辑说明**：该企业注册资本100万元实缴0元，无营收/纳税/流水记录，成立不足3年（2023年6月注册）。基础额度按空壳企业标准设为10万元，因空壳集群风险（关联100+企业）、零实缴资本及治理失效（总分14分），按风险系数0.1~0.5折算，最终建议严格限制在1万~5万元区间。"
        }
        ```
        '''
        data = extract_json_from_string(xx)  # extract_json_struct
        print(data)


    test()
